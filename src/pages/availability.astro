---
import BaseLayout from '../layouts/BaseLayout.astro';
import CallToAction from '../components/sections/CallToAction.astro';

const pricingSeasons = [
  {
    season: 'Winter 2025/2026',
    type: 'winter',
    rows: [
      { start: '01/12/2025', end: '16/12/2025', p4: '€6,760', p5: '€8,028', p6: '€9,126', p7: '€10,056' },
      { start: '16/12/2025', end: '25/12/2025', p4: '€14,520', p5: '€17,243', p6: '€19,602', p7: '€21,599' },
      { start: '26/12/2025', end: '03/01/2026', p4: '€16,380', p5: '€19,451', p6: '€22,113', p7: '€24,365' },
      { start: '04/01/2026', end: '08/01/2026', p4: '€9,720', p5: '€11,543', p6: '€13,122', p7: '€14,459' },
      { start: '09/01/2026', end: '06/02/2026', p4: '€7,500', p5: '€8,906', p6: '€10,125', p7: '€11,156' },
      { start: '07/02/2026', end: '08/03/2026', p4: '€9,720', p5: '€11,543', p6: '€13,122', p7: '€14,459' },
      { start: '09/03/2026', end: '07/04/2026', p4: '€7,500', p5: '€8,906', p6: '€10,125', p7: '€11,156' },
      { start: '08/04/2026', end: '30/04/2026', p4: '€6,760', p5: '€8,028', p6: '€9,126', p7: '€10,056' },
    ]
  },
  {
    season: 'Summer 2026',
    type: 'summer',
    rows: [
      { start: '01/05/2026', end: '02/06/2026', p4: '€6,180', p5: '€7,339', p6: '€8,343', p7: '€9,193' },
      { start: '03/06/2026', end: '23/06/2026', p4: '€6,340', p5: '€7,529', p6: '€8,559', p7: '€9,431' },
      { start: '24/06/2026', end: '18/08/2026', p4: '€6,500', p5: '€7,719', p6: '€8,775', p7: '€9,669' },
      { start: '19/08/2026', end: '01/09/2026', p4: '€6,760', p5: '€8,028', p6: '€9,126', p7: '€10,056' },
      { start: '02/09/2026', end: '15/09/2026', p4: '€6,340', p5: '€7,529', p6: '€8,559', p7: '€9,431' },
      { start: '16/09/2026', end: '30/11/2026', p4: '€6,180', p5: '€7,339', p6: '€8,343', p7: '€9,193' },
    ]
  },
  {
    season: 'Winter 2026/2027',
    type: 'winter',
    rows: [
      { start: '01/12/2026', end: '17/12/2026', p4: '€6,960', p5: '€8,265', p6: '€9,396', p7: '€10,353' },
      { start: '18/12/2026', end: '25/12/2026', p4: '€14,960', p5: '€17,765', p6: '€20,196', p7: '€22,253' },
      { start: '26/12/2026', end: '02/01/2027', p4: '€16,880', p5: '€20,045', p6: '€22,788', p7: '€25,109' },
      { start: '03/01/2027', end: '05/02/2027', p4: '€7,720', p5: '€9,168', p6: '€10,422', p7: '€11,484' },
      { start: '06/02/2027', end: '07/03/2027', p4: '€10,000', p5: '€11,875', p6: '€13,500', p7: '€14,875' },
      { start: '08/03/2027', end: '06/04/2027', p4: '€7,720', p5: '€9,168', p6: '€10,422', p7: '€11,484' },
      { start: '07/04/2027', end: '30/04/2027', p4: '€6,960', p5: '€8,265', p6: '€9,396', p7: '€10,353' },
    ]
  }
];

const included = [
  'Fruit juice, milk, jam & butter stocked on arrival',
  'Daily delivery of bread & pastries',
  'Daily housekeeping',
  'Exclusive use of the property & its facilities',
  'Bedrooms prepared to your requirements with quality bed linen, towels & bath robes',
  'Pre-arrival planning for your stay with our concierge team',
  'Personal welcome',
  'In resort concierge team available daily between 09:00 - 18:00',
  'Welcome gift',
  'Codage luxury toiletries',
  'Mid-stay towel change',
  'Carte d\'hote (train pass) per person',
];

const extras = [
  'In-house catering with a private chef',
  'Delivery of groceries ahead of your arrival',
  'Delivery of pre-prepared meals',
  'Additional linen / towel change',
  'Childcare',
  'Private concierge driver & vehicle',
  'In-house ski & boot fitting, rental & delivery',
  'In-house wellbeing services',
  'Private yoga classes',
  'Airport transfers',
  'Lift passes, ski lessons & guiding',
];
---

<BaseLayout
  title="Availability & Pricing | Chalet Josephine - Luxury Ski Chalet in Chamonix"
  description="Check availability and pricing for Chalet Josephine. Seasonal rates for this luxury 6-bedroom ski chalet in Chamonix. Book your Alpine escape today."
  structuredDataPage="availability"
  breadcrumbs={[{ name: "Availability & Pricing", url: "/availability" }]}
>
  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <h1>Availability & Pricing</h1>
      <p class="page-hero-subtitle">Transparent pricing for an exceptional stay</p>
    </div>
  </section>

  <!-- Pricing Table -->
  <section class="section-spacing section-pricing">
    <div class="container">
      <h2 class="text-center mb-4">Seasonal Rates</h2>
      <p class="text-center text-slate">Prices for the entire chalet (up to 14 guests) &middot; Minimum stay 4 nights</p>
      <div class="mb-12"></div>

      <div class="pricing-table-wrapper">
        <table class="pricing-table">
          <thead>
            <tr>
              <th>Start Date</th>
              <th>End Date</th>
              <th>4 Nights</th>
              <th>5 Nights</th>
              <th>6 Nights</th>
              <th>7 Nights</th>
            </tr>
          </thead>
          <tbody>
            {pricingSeasons.map(group => (
              <>
                <tr class={`season-header season-${group.type}`}>
                  <td colspan="6">{group.season}</td>
                </tr>
                {group.rows.map((row, i) => (
                  <tr class={`price-row ${i % 2 === 0 ? 'row-even' : 'row-odd'}`}>
                    <td>{row.start}</td>
                    <td>{row.end}</td>
                    <td class="price-cell">{row.p4}</td>
                    <td class="price-cell">{row.p5}</td>
                    <td class="price-cell">{row.p6}</td>
                    <td class="price-cell">{row.p7}</td>
                  </tr>
                ))}
              </>
            ))}
          </tbody>
        </table>
      </div>

      <div class="pricing-cta">
        <a href="/contact" class="btn btn-primary">Enquire Now</a>
      </div>
    </div>
  </section>

  <!-- What's Included -->
  <section class="section-spacing section-included bg-pearl">
    <div class="container">
      <div class="included-grid">
        <div>
          <h2>What's Included</h2>
          <ul class="included-list">
            {included.map(item => <li>{item}</li>)}
          </ul>
        </div>
        <div>
          <h2>Optional Extras (Not Included)</h2>
          <ul class="included-list extras">
            {extras.map(item => <li>{item}</li>)}
          </ul>
          <p class="concierge-intro">Our concierge team are also on hand to organise a range of experiences, please ask for details</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Availability Calendar -->
  <section class="section-spacing section-calendar">
    <div class="container">
      <h2 class="text-center mb-4">Availability Calendar</h2>
      <p class="text-center text-slate mb-12">Browse availability for the coming months</p>

      <div class="calendar-wrapper">
        <div class="calendar-months" id="calendar-months"></div>

        <div class="calendar-legend">
          <span class="legend-item"><span class="legend-dot available"></span> Available</span>
          <span class="legend-item"><span class="legend-dot booked"></span> Booked</span>
          <span class="legend-item"><span class="legend-dot provisional"></span> Provisional</span>
        </div>

        <div class="calendar-cta">
          <p>To enquire about specific dates, contact us directly:</p>
          <a href="/contact" class="btn btn-primary">Check My Dates</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking Terms -->
  <section class="section-spacing section-terms bg-pearl">
    <div class="container">
      <h2 class="text-center mb-8">Booking Information</h2>
      <div class="terms-grid">
        <div class="term-card">
          <h3>Deposit</h3>
          <p>A 25% deposit is required to secure your booking, with the balance due 8 weeks before arrival.</p>
        </div>
        <div class="term-card">
          <h3>Cancellation</h3>
          <p>Flexible cancellation policy available. Full details provided at time of booking.</p>
        </div>
        <div class="term-card">
          <h3>Security Deposit</h3>
          <p>A refundable security deposit is required prior to arrival.</p>
        </div>
        <div class="term-card">
          <h3>Check-in / Check-out</h3>
          <p>Check-in from 5pm on day of arrival. Check-out by 10am on day of departure.</p>
        </div>
      </div>
    </div>
  </section>

  <CallToAction
    title="Ready to Book?"
    description="Contact us to check your dates and secure your Alpine escape."
    primaryButtonText="Enquire Now"
    primaryButtonHref="/contact"
    secondaryButtonText="View the Chalet"
    secondaryButtonHref="/about"
  />
</BaseLayout>

<script>
  // Availability data: mark date ranges as 'booked' or 'provisional'
  // Format: { start: 'YYYY-MM-DD', end: 'YYYY-MM-DD', status: 'booked' | 'provisional' }
  const bookings = [
    { start: '2025-12-20', end: '2026-01-04', status: 'booked' },
    { start: '2026-02-14', end: '2026-02-28', status: 'booked' },
    { start: '2026-03-07', end: '2026-03-14', status: 'provisional' },
  ];

  const MONTH_NAMES = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  const DAY_NAMES = ['M','T','W','T','F','S','S'];

  let viewYear = new Date().getFullYear();
  let viewMonth = new Date().getMonth();

  function getStatus(date: Date): 'available' | 'booked' | 'provisional' | 'past' {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    if (date < today) return 'past';

    const d = date.toISOString().slice(0, 10);
    for (const b of bookings) {
      if (d >= b.start && d <= b.end) return b.status as 'booked' | 'provisional';
    }
    return 'available';
  }

  function renderMonth(year: number, month: number, showNav: boolean = false): string {
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const startDow = (firstDay.getDay() + 6) % 7;

    let html = `<div class="cal-month">`;
    html += `<div class="cal-month-header">`;
    if (showNav) {
      html += `<button class="cal-nav-btn" id="cal-prev" aria-label="Previous month">‹</button>`;
    } else {
      html += `<span class="cal-nav-spacer"></span>`;
    }
    html += `<div class="cal-month-title">${MONTH_NAMES[month]} ${year}</div>`;
    if (showNav) {
      html += `<button class="cal-nav-btn" id="cal-next" aria-label="Next month">›</button>`;
    } else {
      html += `<span class="cal-nav-spacer"></span>`;
    }
    html += `</div>`;
    html += `<div class="cal-grid">`;

    DAY_NAMES.forEach(d => { html += `<div class="cal-day-name">${d}</div>`; });

    for (let i = 0; i < startDow; i++) {
      html += `<div class="cal-day empty"></div>`;
    }

    for (let d = 1; d <= lastDay.getDate(); d++) {
      const date = new Date(year, month, d);
      const status = getStatus(date);
      const isToday = date.getTime() === today.getTime();
      html += `<div class="cal-day ${status}${isToday ? ' today' : ''}">${d}</div>`;
    }

    html += `</div></div>`;
    return html;
  }

  function render() {
    const container = document.getElementById('calendar-months');
    if (!container) return;

    const m1 = { year: viewYear, month: viewMonth };
    const m2 = viewMonth === 11
      ? { year: viewYear + 1, month: 0 }
      : { year: viewYear, month: viewMonth + 1 };

    container.innerHTML = renderMonth(m1.year, m1.month, true) + renderMonth(m2.year, m2.month, false);

    document.getElementById('cal-prev')?.addEventListener('click', () => {
      if (viewMonth === 0) { viewMonth = 11; viewYear--; } else { viewMonth--; }
      render();
    });

    document.getElementById('cal-next')?.addEventListener('click', () => {
      if (viewMonth === 11) { viewMonth = 0; viewYear++; } else { viewMonth++; }
      render();
    });
  }

  render();
</script>

<style>
  .page-hero {
    background: linear-gradient(135deg, var(--color-charcoal) 0%, var(--color-alpine) 100%);
    padding: var(--space-20) 0;
    text-align: center;
    color: white;
  }
  .page-hero h1 { color: white; margin-bottom: var(--space-4); }
  .page-hero-subtitle { font-size: var(--text-xl); color: rgba(255,255,255,0.9); }

  .text-slate { color: var(--color-slate); }
  .text-center { text-align: center; }

  /* Tighter spacing between sections on this page */
  .section-pricing {
    padding-top: var(--space-12);
    padding-bottom: var(--space-8);
  }
  .section-included {
    padding-top: var(--space-8);
    padding-bottom: var(--space-8);
  }
  .section-calendar {
    padding-top: var(--space-8);
    padding-bottom: var(--space-8);
  }
  .section-terms {
    padding-top: var(--space-8);
  }
  @media (min-width: 1024px) {
    .section-pricing {
      padding-top: var(--space-16);
      padding-bottom: var(--space-12);
    }
    .section-included {
      padding-top: var(--space-12);
      padding-bottom: var(--space-12);
    }
    .section-calendar {
      padding-top: var(--space-12);
      padding-bottom: var(--space-12);
    }
    .section-terms {
      padding-top: var(--space-12);
    }
  }

  .pricing-table-wrapper {
    overflow-x: auto;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--color-stone);
  }

  .pricing-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
    min-width: 640px;
  }

  .pricing-table thead th {
    background: var(--color-charcoal);
    color: white;
    padding: var(--space-4) var(--space-4);
    text-align: center;
    font-family: var(--font-heading);
    font-size: var(--text-sm);
    font-weight: var(--font-weight-semibold);
    letter-spacing: 0.03em;
    white-space: nowrap;
  }

  .pricing-table thead th:first-child {
    border-radius: var(--radius-2xl) 0 0 0;
    text-align: left;
    padding-left: var(--space-6);
  }

  .pricing-table thead th:last-child {
    border-radius: 0 var(--radius-2xl) 0 0;
  }

  .season-header td {
    padding: var(--space-3) var(--space-6);
    font-family: var(--font-heading);
    font-size: var(--text-base);
    font-weight: var(--font-weight-semibold);
    letter-spacing: 0.02em;
    border-bottom: 1px solid var(--color-stone);
  }

  .season-winter td {
    background: var(--color-alpine);
    color: white;
  }

  .season-summer td {
    background: #8B6F4A;
    color: white;
  }

  .price-row td {
    padding: var(--space-3) var(--space-4);
    text-align: center;
    border-bottom: 1px solid var(--color-stone);
    color: var(--color-charcoal);
  }

  .price-row td:first-child,
  .price-row td:nth-child(2) {
    text-align: left;
    padding-left: var(--space-6);
    white-space: nowrap;
  }

  .price-cell {
    font-weight: var(--font-weight-medium);
    white-space: nowrap;
  }

  .row-even { background: white; }
  .row-odd { background: var(--color-pearl); }

  .price-row:hover {
    background: rgba(45, 80, 100, 0.06);
  }

  .pricing-table tbody tr:last-child td:first-child {
    border-radius: 0 0 0 var(--radius-2xl);
  }

  .pricing-table tbody tr:last-child td:last-child {
    border-radius: 0 0 var(--radius-2xl) 0;
  }

  .pricing-cta {
    text-align: center;
    margin-top: var(--space-8);
  }

  .included-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-16);
  }
  @media (max-width: 768px) { .included-grid { grid-template-columns: 1fr; } }

  .included-grid h2 { margin-bottom: var(--space-6); }

  .included-list {
    list-style: none;
    padding: 0;
  }
  .included-list li {
    padding: var(--space-3) 0;
    padding-left: var(--space-6);
    position: relative;
    color: var(--color-charcoal);
    border-bottom: 1px solid var(--color-stone);
  }
  .included-list li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--color-alpine);
    font-weight: bold;
  }
  .included-list.extras li::before { content: '+'; color: var(--color-gold); }

  .concierge-intro {
    margin-top: var(--space-6);
    margin-bottom: var(--space-4);
    color: var(--color-charcoal);
    font-weight: var(--font-weight-medium);
    font-size: var(--text-sm);
    line-height: var(--leading-relaxed);
  }

  .calendar-wrapper {
    background: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    border: 1px solid var(--color-stone);
    box-shadow: var(--shadow-sm);
  }

  .calendar-months {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-8);
  }
  @media (max-width: 768px) { .calendar-months { grid-template-columns: 1fr; } }

  .calendar-months :global(.cal-month) {
    padding: var(--space-4);
  }

  .calendar-months :global(.cal-month-header) {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-8);
    padding: 0 var(--space-2);
  }

  .calendar-months :global(.cal-month-title) {
    font-family: var(--font-heading);
    font-size: var(--text-2xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-charcoal);
    text-align: center;
    flex: 1;
  }

  .calendar-months :global(.cal-nav-btn) {
    width: 36px;
    height: 36px;
    border: none;
    background: none;
    font-size: var(--text-2xl);
    cursor: pointer;
    color: var(--color-charcoal);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color var(--transition-base);
    font-family: var(--font-body);
    line-height: 1;
  }

  .calendar-months :global(.cal-nav-btn:hover) {
    color: var(--color-alpine);
  }

  .calendar-months :global(.cal-nav-spacer) {
    width: 36px;
  }

  .calendar-months :global(.cal-grid) {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    row-gap: var(--space-4);
  }

  .calendar-months :global(.cal-day-name) {
    text-align: center;
    font-size: var(--text-sm);
    color: var(--color-slate);
    padding-bottom: var(--space-4);
    font-weight: var(--font-weight-medium);
    border-bottom: 1px solid var(--color-stone);
    margin-bottom: var(--space-2);
  }

  .calendar-months :global(.cal-day) {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-base);
    padding: var(--space-2) 0;
    cursor: default;
    border-radius: var(--radius-md);
    transition: background var(--transition-base);
  }

  .calendar-months :global(.cal-day.empty) { background: transparent; }

  .calendar-months :global(.cal-day.available) {
    color: var(--color-charcoal);
    font-weight: var(--font-weight-medium);
  }

  .calendar-months :global(.cal-day.booked) {
    color: #dc2626;
    text-decoration: line-through;
    text-decoration-thickness: 1.5px;
  }

  .calendar-months :global(.cal-day.provisional) {
    color: var(--color-gold);
    font-style: italic;
  }

  .calendar-months :global(.cal-day.past) {
    color: #d1d5db;
  }

  .calendar-months :global(.cal-day.today) {
    font-weight: bold;
    color: var(--color-alpine);
    background: rgba(45, 80, 100, 0.08);
    border-radius: var(--radius-md);
  }

  .calendar-legend {
    display: flex;
    gap: var(--space-8);
    justify-content: center;
    margin-bottom: var(--space-6);
    flex-wrap: wrap;
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-stone);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-slate);
  }

  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  .legend-dot.available { background: var(--color-charcoal); }
  .legend-dot.booked { background: #dc2626; }
  .legend-dot.provisional { background: var(--color-gold); }

  .calendar-cta {
    text-align: center;
    margin-top: var(--space-4);
  }
  .calendar-cta p {
    color: var(--color-slate);
    margin-bottom: var(--space-4);
  }

  .mt-6 { margin-top: var(--space-6); }

  .terms-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-6);
  }
  @media (max-width: 1024px) { .terms-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 640px) { .terms-grid { grid-template-columns: 1fr; } }

  .term-card {
    padding: var(--space-6);
    background: white;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);
  }
  .term-card h3 {
    font-size: var(--text-lg);
    color: var(--color-alpine);
    margin-bottom: var(--space-3);
  }
  .term-card p {
    font-size: var(--text-sm);
    color: var(--color-slate);
    line-height: var(--leading-relaxed);
  }
</style>
