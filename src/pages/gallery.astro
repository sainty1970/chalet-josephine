---
import BaseLayout from '../layouts/BaseLayout.astro';
import CallToAction from '../components/sections/CallToAction.astro';

const categories = ['All', 'Exterior', 'Living Areas', 'Bedrooms', 'Bathrooms', 'Kitchen', 'Views', 'Amenities'];

const images = [
  // Exterior
  { category: 'Exterior', src: '/images/Winter Exterior Rouges 2.jpg', caption: 'Winter exterior with Mont Blanc views' },
  { category: 'Exterior', src: '/images/Winter Exterior Drus 2.jpg', caption: 'Chalet entrance in winter' },
  { category: 'Exterior', src: '/images/Summer Exterior Front Mid 1.jpg', caption: 'Summer exterior' },
  { category: 'Exterior', src: '/images/Balcony 5.jpg', caption: 'Private balcony' },

  // Living Areas
  { category: 'Living Areas', src: '/images/Salon 1.jpg', caption: 'Main living room with fireplace' },
  { category: 'Living Areas', src: '/images/Salon 2.jpg', caption: 'Lounge seating area' },
  { category: 'Living Areas', src: '/images/Dining Salon 2.jpg', caption: 'Open-plan living and dining' },
  { category: 'Living Areas', src: '/images/Dining 3.jpg', caption: 'Dining area seats 14' },
  { category: 'Living Areas', src: '/images/Petit Sejour 2.jpg', caption: 'Cosy sitting room' },
  { category: 'Living Areas', src: '/images/Petit Sejour 3.jpg', caption: 'Reading nook' },

  // Bedrooms
  { category: 'Bedrooms', src: '/images/Master Bed 1.jpg', caption: 'Master bedroom' },
  { category: 'Bedrooms', src: '/images/Master Bed 5.jpg', caption: 'Master suite seating' },
  { category: 'Bedrooms', src: '/images/Master Bed 6.jpg', caption: 'Master bedroom detail' },
  { category: 'Bedrooms', src: '/images/Bedroom 2 2.jpg', caption: 'Bedroom 2' },
  { category: 'Bedrooms', src: '/images/Bedroom 2 4.jpg', caption: 'Bedroom 2 detail' },
  { category: 'Bedrooms', src: '/images/Bedroom 3 2.jpg', caption: 'Bedroom 3' },
  { category: 'Bedrooms', src: '/images/Bedroom 3 2 (1).jpg', caption: 'Bedroom 3 view' },
  { category: 'Bedrooms', src: '/images/Bedroom 3 3.jpg', caption: 'Bedroom 3 detail' },
  { category: 'Bedrooms', src: '/images/Bedroom 4 4.jpg', caption: 'Bedroom 4' },
  { category: 'Bedrooms', src: '/images/Bedroom 5 1.jpg', caption: 'Bedroom 5' },
  { category: 'Bedrooms', src: '/images/Bedroom 5 2.jpg', caption: 'Bedroom 5 detail' },
  { category: 'Bedrooms', src: '/images/Bunk Room 1.jpg', caption: 'Bunk room' },

  // Bathrooms
  { category: 'Bathrooms', src: '/images/Master Bed Ensuite 1.jpg', caption: 'Master en-suite' },
  { category: 'Bathrooms', src: '/images/Bedroom 2 Ensuite 2.jpg', caption: 'Bedroom 2 en-suite' },
  { category: 'Bathrooms', src: '/images/Bedroom 3 Ensuite 1.jpg', caption: 'Bedroom 3 en-suite' },
  { category: 'Bathrooms', src: '/images/Bedroom 4 Ensuite 1.jpg', caption: 'Bedroom 4 en-suite' },
  { category: 'Bathrooms', src: '/images/Bedroom 5 Ensuite 1.jpg', caption: 'Bedroom 5 en-suite' },

  // Kitchen
  { category: 'Kitchen', src: '/images/Kitchen 4.jpg', caption: 'Gourmet kitchen' },
  { category: 'Kitchen', src: '/images/Kitchen Out 2.jpg', caption: 'Kitchen overview' },
  { category: 'Kitchen', src: '/images/Dining Kitchen 2.jpg', caption: 'Kitchen and dining' },

  // Views
  { category: 'Views', src: '/images/Winter Balcony View 1.jpg', caption: 'Mont Blanc from the balcony' },
  { category: 'Views', src: '/images/Summer Deck View 2.jpg', caption: 'Summer deck views' },
  { category: 'Views', src: '/images/Summer Hot Tub View 3.jpg', caption: 'Hot tub with Alpine views' },

  // Amenities
  { category: 'Amenities', src: '/images/Sauna 2.jpg', caption: 'Private sauna' },
  { category: 'Amenities', src: '/images/Sauna 3.jpg', caption: 'Sauna detail' },
  { category: 'Amenities', src: '/images/Games Room 1.jpg', caption: 'Games room' },
  { category: 'Amenities', src: '/images/Study 1.jpg', caption: 'Study area' },
  { category: 'Amenities', src: '/images/Study 5.jpg', caption: 'Study workspace' },
  { category: 'Amenities', src: '/images/Boot Room 1.jpg', caption: 'Boot room' },
];
---

<BaseLayout
  title="Gallery | Chalet Josephine - Luxury Ski Chalet in Chamonix"
  description="Browse our stunning photo gallery of Chalet Josephine - featuring beautiful interiors, breathtaking Mont Blanc views, outdoor spaces and premium amenities."
  structuredDataPage="gallery"
  breadcrumbs={[{ name: "Gallery", url: "/gallery" }]}
>
  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <h1>Gallery</h1>
      <p class="page-hero-subtitle">A Visual Tour of Your Alpine Sanctuary</p>
    </div>
  </section>

  <section class="section-spacing">
    <div class="container">
      <!-- Category Filter -->
      <div class="filter-bar" id="filter-bar">
        {categories.map((cat, i) => (
          <button class={`filter-btn ${i === 0 ? 'active' : ''}`} data-category={cat}>{cat}</button>
        ))}
      </div>

      <!-- Gallery Grid -->
      <div class="gallery-grid" id="gallery-grid">
        {images.map((img, i) => (
          <div class="gallery-item" data-category={img.category} data-index={i}>
            <div class="gallery-image">
              <img src={img.src} alt={img.caption} loading="lazy" />
              <div class="gallery-overlay">
                <span class="zoom-icon">üîç</span>
                <p class="overlay-caption">{img.caption}</p>
              </div>
            </div>
          </div>
        ))}
      </div>

      <p class="gallery-note" id="no-results" style="display:none;">No photos in this category yet.</p>
    </div>
  </section>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="lightbox-close" id="lightbox-close" aria-label="Close">‚úï</button>
    <button class="lightbox-prev" id="lightbox-prev" aria-label="Previous">‚Äπ</button>
    <button class="lightbox-next" id="lightbox-next" aria-label="Next">‚Ä∫</button>
    <div class="lightbox-content">
      <div class="lightbox-image">
        <img id="lightbox-img" src="" alt="" />
      </div>
      <p class="lightbox-caption" id="lightbox-caption-display"></p>
    </div>
  </div>

  <CallToAction
    title="Love What You See?"
    description="Check availability and book your stay at Chalet Josephine."
    primaryButtonText="Check Availability"
    primaryButtonHref="/availability"
    secondaryButtonText="Contact Us"
    secondaryButtonHref="/contact"
  />
</BaseLayout>

<script>
  const filterBar = document.getElementById('filter-bar');
  const galleryGrid = document.getElementById('gallery-grid');
  const lightbox = document.getElementById('lightbox');
  const lightboxClose = document.getElementById('lightbox-close');
  const lightboxPrev = document.getElementById('lightbox-prev');
  const lightboxNext = document.getElementById('lightbox-next');
  const lightboxCaptionDisplay = document.getElementById('lightbox-caption-display');
  const lightboxCaptionText = document.getElementById('lightbox-caption');
  const noResults = document.getElementById('no-results');

  let currentIndex = 0;
  let visibleItems: HTMLElement[] = [];

  // Filter logic
  filterBar?.addEventListener('click', (e) => {
    const btn = (e.target as HTMLElement).closest('.filter-btn') as HTMLButtonElement;
    if (!btn) return;

    filterBar.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const selected = btn.dataset.category;
    const items = galleryGrid?.querySelectorAll<HTMLElement>('.gallery-item');

    let visible = 0;
    items?.forEach(item => {
      const show = selected === 'All' || item.dataset.category === selected;
      item.style.display = show ? '' : 'none';
      if (show) visible++;
    });

    if (noResults) noResults.style.display = visible === 0 ? 'block' : 'none';
  });

  // Build visible items list
  function getVisibleItems(): HTMLElement[] {
    return Array.from(galleryGrid?.querySelectorAll<HTMLElement>('.gallery-item') ?? [])
      .filter(item => item.style.display !== 'none');
  }

  // Open lightbox
  galleryGrid?.addEventListener('click', (e) => {
    const item = (e.target as HTMLElement).closest<HTMLElement>('.gallery-item');
    if (!item) return;

    visibleItems = getVisibleItems();
    currentIndex = visibleItems.indexOf(item);
    openLightbox(currentIndex);
  });

  function openLightbox(index: number) {
    if (!lightbox) return;
    const item = visibleItems[index];
    const img = item?.querySelector('img');
    const caption = img?.alt ?? '';

    const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
    if (lightboxImg && img) {
      lightboxImg.src = img.src;
      lightboxImg.alt = img.alt;
    }

    if (lightboxCaptionDisplay) lightboxCaptionDisplay.textContent = caption;

    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Update nav visibility
    if (lightboxPrev) lightboxPrev.style.opacity = index === 0 ? '0.3' : '1';
    if (lightboxNext) lightboxNext.style.opacity = index === visibleItems.length - 1 ? '0.3' : '1';
  }

  function closeLightbox() {
    lightbox?.classList.remove('active');
    document.body.style.overflow = '';
  }

  lightboxClose?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  lightboxPrev?.addEventListener('click', () => {
    if (currentIndex > 0) openLightbox(--currentIndex);
  });

  lightboxNext?.addEventListener('click', () => {
    if (currentIndex < visibleItems.length - 1) openLightbox(++currentIndex);
  });

  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft' && currentIndex > 0) openLightbox(--currentIndex);
    if (e.key === 'ArrowRight' && currentIndex < visibleItems.length - 1) openLightbox(++currentIndex);
  });
</script>

<style>
  .page-hero {
    background: linear-gradient(135deg, var(--color-charcoal) 0%, var(--color-alpine) 100%);
    padding: var(--space-20) 0;
    text-align: center;
    color: white;
  }
  .page-hero h1 { color: white; margin-bottom: var(--space-4); }
  .page-hero-subtitle { font-size: var(--text-xl); color: rgba(255,255,255,0.9); }

  .filter-bar {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: var(--space-12);
  }

  .filter-btn {
    padding: var(--space-2) var(--space-5);
    border: 2px solid var(--color-stone);
    background: white;
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    cursor: pointer;
    transition: all var(--transition-base);
    font-family: var(--font-body);
  }
  .filter-btn:hover, .filter-btn.active {
    background: var(--color-alpine);
    border-color: var(--color-alpine);
    color: white;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-4);
  }
  @media (max-width: 1024px) { .gallery-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 640px) { .gallery-grid { grid-template-columns: 1fr; } }

  .gallery-item {
    border-radius: var(--radius-xl);
    overflow: hidden;
    cursor: pointer;
    transition: transform var(--transition-base);
    position: relative;
  }
  .gallery-item:hover { transform: scale(1.02); }
  .gallery-item:hover .gallery-overlay { opacity: 1; }

  .gallery-image {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-xl);
  }

  .gallery-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 4/3;
    display: block;
  }

  .gallery-overlay {
    position: absolute;
    inset: 0;
    background: rgba(31, 41, 55, 0.7);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity var(--transition-base);
    gap: var(--space-2);
  }
  .zoom-icon { font-size: 2rem; color: white; }
  .overlay-caption { color: white; font-size: var(--text-sm); text-align: center; padding: 0 var(--space-4); }

  .gallery-note {
    text-align: center;
    color: var(--color-slate);
    padding: var(--space-12) 0;
    font-size: var(--text-lg);
  }

  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .lightbox.active {
    opacity: 1;
    pointer-events: all;
  }

  .lightbox-content {
    max-width: 900px;
    width: 90%;
    text-align: center;
  }

  .lightbox-image {
    border-radius: var(--radius-xl);
    overflow: hidden;
    margin-bottom: var(--space-4);
    max-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-image img {
    max-width: 100%;
    max-height: 80vh;
    width: auto;
    height: auto;
    display: block;
  }

  .lightbox-caption {
    color: rgba(255,255,255,0.8);
    font-size: var(--text-base);
  }

  .lightbox-close,
  .lightbox-prev,
  .lightbox-next {
    position: fixed;
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    cursor: pointer;
    transition: background var(--transition-base);
    font-size: var(--text-2xl);
    line-height: 1;
    border-radius: var(--radius-full);
  }
  .lightbox-close:hover,
  .lightbox-prev:hover,
  .lightbox-next:hover { background: rgba(255,255,255,0.2); }

  .lightbox-close {
    top: var(--space-6);
    right: var(--space-6);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-prev {
    left: var(--space-6);
    top: 50%;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    font-size: var(--text-3xl);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-next {
    right: var(--space-6);
    top: 50%;
    transform: translateY(-50%);
    width: 48px;
    height: 48px;
    font-size: var(--text-3xl);
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>
