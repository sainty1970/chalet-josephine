---
import BaseLayout from '../layouts/BaseLayout.astro';
import CallToAction from '../components/sections/CallToAction.astro';

const seasons = [
  {
    name: 'Peak Winter (Christmas & New Year)',
    dates: 'Dec 20 – Jan 4',
    price: '€12,000',
    perWeek: true,
    minStay: 7
  },
  {
    name: 'High Winter (February Half Term)',
    dates: 'Feb 14 – Feb 28',
    price: '€10,000',
    perWeek: true,
    minStay: 7
  },
  {
    name: 'Mid Winter',
    dates: 'Jan 5 – Feb 13 & Mar 1 – Mar 31',
    price: '€7,500',
    perWeek: true,
    minStay: 7
  },
  {
    name: 'Summer',
    dates: 'Jun 15 – Sep 15',
    price: '€5,000',
    perWeek: true,
    minStay: 7
  },
];

const included = [
  'Linen and towels',
  'Cleaning service (mid-week and end of stay)',
  'Welcome hamper',
  'WiFi',
  'Parking for 2 vehicles',
  'Hot tub access',
  'Sauna access',
  'Airport transfer (on request)',
];

const extras = [
  'Private chef (on request)',
  'Ski instructor (on request)',
  'Childcare services (on request)',
  'Grocery pre-stocking (on request)',
  'Ski hire and lift passes (on request)',
];
---

<BaseLayout
  title="Availability & Pricing | Chalet Josephine - Luxury Ski Chalet in Chamonix"
  description="Check availability and pricing for Chalet Josephine. Seasonal rates for this luxury 6-bedroom ski chalet in Chamonix. Book your Alpine escape today."
>
  <!-- Page Hero -->
  <section class="page-hero">
    <div class="container">
      <h1>Availability & Pricing</h1>
      <p class="page-hero-subtitle">Transparent pricing for an exceptional stay</p>
    </div>
  </section>

  <!-- Pricing Table -->
  <section class="section-spacing">
    <div class="container">
      <h2 class="text-center mb-4">Seasonal Rates</h2>
      <p class="text-center text-slate mb-12">All prices are per week for the entire chalet (up to 12 guests)</p>

      <div class="pricing-grid">
        {seasons.map(season => (
          <div class="pricing-card">
            <h3>{season.name}</h3>
            <p class="dates">{season.dates}</p>
            <div class="price">{season.price}</div>
            <p class="per-week">per week</p>
            <p class="min-stay">Minimum {season.minStay} nights</p>
            <a href="/contact" class="btn btn-primary">Enquire Now</a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- What's Included -->
  <section class="section-spacing bg-pearl">
    <div class="container">
      <div class="included-grid">
        <div>
          <h2>What's Included</h2>
          <ul class="included-list">
            {included.map(item => <li>{item}</li>)}
          </ul>
        </div>
        <div>
          <h2>Optional Extras</h2>
          <ul class="included-list extras">
            {extras.map(item => <li>{item}</li>)}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Availability Calendar -->
  <section class="section-spacing">
    <div class="container">
      <h2 class="text-center mb-4">Availability Calendar</h2>
      <p class="text-center text-slate mb-12">Browse availability for the coming months</p>

      <div class="calendar-wrapper">
        <div class="calendar-legend">
          <span class="legend-item"><span class="legend-dot available"></span> Available</span>
          <span class="legend-item"><span class="legend-dot booked"></span> Booked</span>
          <span class="legend-item"><span class="legend-dot provisional"></span> Provisional</span>
        </div>

        <div class="calendar-nav">
          <button class="cal-btn" id="cal-prev">‹</button>
          <h3 id="cal-heading"></h3>
          <button class="cal-btn" id="cal-next">›</button>
        </div>

        <div class="calendar-months" id="calendar-months"></div>

        <div class="calendar-cta">
          <p>To enquire about specific dates, contact us directly:</p>
          <a href="/contact" class="btn btn-primary">Check My Dates</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking Terms -->
  <section class="section-spacing bg-pearl">
    <div class="container">
      <h2 class="text-center mb-8">Booking Information</h2>
      <div class="terms-grid">
        <div class="term-card">
          <h3>Deposit</h3>
          <p>A 25% deposit is required to secure your booking, with the balance due 8 weeks before arrival.</p>
        </div>
        <div class="term-card">
          <h3>Cancellation</h3>
          <p>Flexible cancellation policy available. Full details provided at time of booking.</p>
        </div>
        <div class="term-card">
          <h3>Security Deposit</h3>
          <p>A refundable security deposit of €2,000 is required prior to arrival.</p>
        </div>
        <div class="term-card">
          <h3>Check-in / Check-out</h3>
          <p>Check-in from 4pm on day of arrival. Check-out by 10am on day of departure.</p>
        </div>
      </div>
    </div>
  </section>

  <CallToAction
    title="Ready to Book?"
    description="Contact us to check your dates and secure your Alpine escape."
    primaryButtonText="Enquire Now"
    primaryButtonHref="/contact"
    secondaryButtonText="View the Chalet"
    secondaryButtonHref="/about"
  />
</BaseLayout>

<script>
  // Availability data: mark date ranges as 'booked' or 'provisional'
  // Format: { start: 'YYYY-MM-DD', end: 'YYYY-MM-DD', status: 'booked' | 'provisional' }
  const bookings = [
    { start: '2025-12-20', end: '2026-01-04', status: 'booked' },
    { start: '2026-02-14', end: '2026-02-28', status: 'booked' },
    { start: '2026-03-07', end: '2026-03-14', status: 'provisional' },
  ];

  const MONTH_NAMES = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  const DAY_NAMES = ['Mo','Tu','We','Th','Fr','Sa','Su'];

  let viewYear = new Date().getFullYear();
  let viewMonth = new Date().getMonth();

  function getStatus(date: Date): 'available' | 'booked' | 'provisional' | 'past' {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    if (date < today) return 'past';

    const d = date.toISOString().slice(0, 10);
    for (const b of bookings) {
      if (d >= b.start && d <= b.end) return b.status as 'booked' | 'provisional';
    }
    return 'available';
  }

  function renderMonth(year: number, month: number): string {
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // Monday-first: getDay() returns 0=Sun, adjust
    const startDow = (firstDay.getDay() + 6) % 7;

    let html = `<div class="cal-month">`;
    html += `<div class="cal-month-title">${MONTH_NAMES[month]} ${year}</div>`;
    html += `<div class="cal-grid">`;

    DAY_NAMES.forEach(d => { html += `<div class="cal-day-name">${d}</div>`; });

    // Empty cells before first day
    for (let i = 0; i < startDow; i++) {
      html += `<div class="cal-day empty"></div>`;
    }

    for (let d = 1; d <= lastDay.getDate(); d++) {
      const date = new Date(year, month, d);
      const status = getStatus(date);
      const isToday = date.getTime() === today.getTime();
      html += `<div class="cal-day ${status}${isToday ? ' today' : ''}">${d}</div>`;
    }

    html += `</div></div>`;
    return html;
  }

  function render() {
    const heading = document.getElementById('cal-heading');
    const container = document.getElementById('calendar-months');
    if (!heading || !container) return;

    // Show current month and next month
    const m1 = { year: viewYear, month: viewMonth };
    const m2 = viewMonth === 11
      ? { year: viewYear + 1, month: 0 }
      : { year: viewYear, month: viewMonth + 1 };

    heading.textContent = `${MONTH_NAMES[m1.month]} – ${MONTH_NAMES[m2.month]} ${m2.year}`;
    container.innerHTML = renderMonth(m1.year, m1.month) + renderMonth(m2.year, m2.month);
  }

  document.getElementById('cal-prev')?.addEventListener('click', () => {
    if (viewMonth === 0) { viewMonth = 11; viewYear--; } else { viewMonth--; }
    render();
  });

  document.getElementById('cal-next')?.addEventListener('click', () => {
    if (viewMonth === 11) { viewMonth = 0; viewYear++; } else { viewMonth++; }
    render();
  });

  render();
</script>

<style>
  .page-hero {
    background: linear-gradient(135deg, var(--color-charcoal) 0%, var(--color-alpine) 100%);
    padding: var(--space-20) 0;
    text-align: center;
    color: white;
  }
  .page-hero h1 { color: white; margin-bottom: var(--space-4); }
  .page-hero-subtitle { font-size: var(--text-xl); color: rgba(255,255,255,0.9); }

  .text-slate { color: var(--color-slate); }
  .text-center { text-align: center; }

  .pricing-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
  }
  @media (max-width: 768px) { .pricing-grid { grid-template-columns: 1fr; } }

  .pricing-card {
    background: white;
    border: 2px solid var(--color-stone);
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    text-align: center;
    transition: border-color var(--transition-base), box-shadow var(--transition-base);
  }
  .pricing-card:hover {
    border-color: var(--color-alpine);
    box-shadow: var(--shadow-lg);
  }
  .pricing-card h3 {
    font-size: var(--text-xl);
    margin-bottom: var(--space-2);
  }
  .dates {
    color: var(--color-slate);
    font-size: var(--text-sm);
    margin-bottom: var(--space-6);
  }
  .price {
    font-family: var(--font-heading);
    font-size: var(--text-5xl);
    color: var(--color-alpine);
    font-weight: bold;
  }
  .per-week {
    color: var(--color-slate);
    font-size: var(--text-sm);
    margin-bottom: var(--space-2);
  }
  .min-stay {
    color: var(--color-slate);
    font-size: var(--text-xs);
    margin-bottom: var(--space-6);
  }

  .included-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-16);
  }
  @media (max-width: 768px) { .included-grid { grid-template-columns: 1fr; } }

  .included-grid h2 { margin-bottom: var(--space-6); }

  .included-list {
    list-style: none;
    padding: 0;
  }
  .included-list li {
    padding: var(--space-3) 0;
    padding-left: var(--space-6);
    position: relative;
    color: var(--color-charcoal);
    border-bottom: 1px solid var(--color-stone);
  }
  .included-list li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--color-alpine);
    font-weight: bold;
  }
  .included-list.extras li::before { content: '+'; color: var(--color-gold); }

  .calendar-wrapper {
    background: var(--color-pearl);
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
  }

  .calendar-legend {
    display: flex;
    gap: var(--space-6);
    justify-content: center;
    margin-bottom: var(--space-6);
    flex-wrap: wrap;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-slate);
  }
  .legend-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
  }
  .legend-dot.available { background: #10b981; }
  .legend-dot.booked { background: #ef4444; }
  .legend-dot.provisional { background: #f59e0b; }

  .calendar-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-6);
    margin-bottom: var(--space-6);
  }
  .calendar-nav h3 {
    font-size: var(--text-xl);
    min-width: 200px;
    text-align: center;
  }
  .cal-btn {
    width: 40px;
    height: 40px;
    border: 2px solid var(--color-stone);
    background: white;
    border-radius: var(--radius-full);
    font-size: var(--text-2xl);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-base);
    font-family: var(--font-body);
    line-height: 1;
  }
  .cal-btn:hover {
    border-color: var(--color-alpine);
    color: var(--color-alpine);
  }

  .calendar-months {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-8);
  }
  @media (max-width: 768px) { .calendar-months { grid-template-columns: 1fr; } }

  .cal-month { background: white; border-radius: var(--radius-xl); padding: var(--space-6); }
  .cal-month-title {
    font-size: var(--text-lg);
    font-weight: 600;
    text-align: center;
    margin-bottom: var(--space-4);
    color: var(--color-charcoal);
  }
  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
  }
  .cal-day-name {
    text-align: center;
    font-size: var(--text-xs);
    color: var(--color-slate);
    padding: var(--space-1) 0;
    font-weight: 600;
  }
  .cal-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-xs);
    border-radius: var(--radius-sm);
    cursor: default;
  }
  .cal-day.empty { background: transparent; }
  .cal-day.available { background: #d1fae5; color: #065f46; }
  .cal-day.booked { background: #fee2e2; color: #991b1b; }
  .cal-day.provisional { background: #fef3c7; color: #92400e; }
  .cal-day.past { color: #d1d5db; }
  .cal-day.today { font-weight: bold; outline: 2px solid var(--color-alpine); }

  .calendar-cta {
    text-align: center;
    margin-top: var(--space-8);
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-stone);
  }
  .calendar-cta p {
    color: var(--color-slate);
    margin-bottom: var(--space-4);
  }

  .mt-6 { margin-top: var(--space-6); }

  .terms-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-6);
  }
  @media (max-width: 1024px) { .terms-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 640px) { .terms-grid { grid-template-columns: 1fr; } }

  .term-card {
    padding: var(--space-6);
    background: white;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);
  }
  .term-card h3 {
    font-size: var(--text-lg);
    color: var(--color-alpine);
    margin-bottom: var(--space-3);
  }
  .term-card p {
    font-size: var(--text-sm);
    color: var(--color-slate);
    line-height: var(--leading-relaxed);
  }
</style>
